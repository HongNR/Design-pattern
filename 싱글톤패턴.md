
# 싱글톤 패턴 (Singleton Pattern)

##  개념

**싱글톤 패턴**은 **하나의 클래스에 오직 하나의 인스턴스만 가지도록 보장**하는 디자인 패턴입니다. 

프로그램 전역에서 이 단일 인스턴스에 접근할 수 있는 지점을 제공하여, 객체가 여러 개 생성되는 것을 방지합니다.

> **쉽게 말해,** 인스턴스가 필요할 때마다 새로 만들지 않고, 이미 만들어진 단 하나의 인스턴스를 가져와 재활용하는 기법입니다.
>
> 이는 **메모리 절약**과 **데이터 일관성 유지**에 큰 장점이 있습니다.

<br>

##  사용하는 이유

  * **메모리 낭비 방지**: 하나의 인스턴스를 프로그램 전체에서 공유하므로 메모리를 효율적으로 사용할 수 있습니다.
  * **데이터 공유 용이**: 전역적으로 유일한 객체이므로, 다른 클래스에서 데이터를 공유하고 수정하기 쉽습니다. (예: 설정 값, 데이터베이스 연결 객체)
  * **속도 향상**: 이미 생성된 인스턴스를 반환하므로 객체 생성에 드는 시간을 줄일 수 있습니다.

> **💡 Tip\!**
> 싱글톤 패턴은 **전역 변수**의 개념을 클래스 단위로 적용한 것이라고 이해하면 쉽습니다.

<br>

## 단점 및 고려사항

싱글톤 패턴은 유용하지만, 잘못 사용하면 여러 문제를 야기할 수 있어 '안티 패턴'으로 불리기도 합니다.

  * **모듈 간의 높은 의존성**: 싱글톤 인스턴스를 여러 모듈이 직접 공유하게 되면, 서로 간의 결합도가 높아져 코드 수정 및 유지보수가 어려워집니다.
  * **테스트의 어려움**: 전역 상태를 공유하기 때문에 각 단위 테스트가 서로에게 영향을 미칠 수 있어 독립적인 테스트가 힘듭니다.
  * **SOLID 원칙 위배 가능성**: 객체 지향 설계의 핵심 원칙들을 위배할 수 있습니다.
      * **단일 책임 원칙 (SRP)**: 싱글톤 인스턴스가 너무 많은 역할과 데이터를 가지게 되어 단일 책임 원칙을 위반하기 쉽습니다.
      * **개방-폐쇄 원칙 (OCP)**: 싱글톤을 수정할 경우, 이를 사용하는 모든 클라이언트 코드에 영향을 줄 수 있어 확장성이 떨어집니다.
      * **의존 역전 원칙 (DIP)**: 클라이언트가 인터페이스가 아닌 클래스에 직접 의존하게 만들어 유연성을 저해합니다.

> 이처럼 싱글톤 패턴은 유연성을 떨어뜨릴 수 있으므로 직접 구현하기보다는, **스프링(Spring) 프레임워크**와 같은 도구의 도움을 받는 것이 좋습니다. 프레임워크를 사용하면 싱글톤의 장점은 살리면서 단점은 보완할 수 있습니다.

<br>

## 싱글톤 패턴 구현 기법 종류
## 1. Eager Initialization 

가장 직관적이면서도 간단한 싱글톤 구현 기법으로, 클래스 로딩 시점에 인스턴스를 미리 한 번만 생성합니다.

-   **특징**: `static final` 키워드를 사용하여 클래스 로드 시점에 객체를 생성합니다.
-   **장점 (멀티 스레드 안전성)**: `static final`로 선언된 인스턴스는 JVM에 의해 단 한 번만 생성되므로, 멀티 스레드 환경에서도 스레드 동기화 문제없이 안전하게 사용할 수 있습니다.
-   **단점 (자원 낭비 가능성)**: 해당 객체를 당장 사용하지 않더라도, 클래스가 로드될 때 무조건 `static` 멤버가 메모리에 적재됩니다. 만약 이 객체가 리소스를 많이 차지한다면 **공간 자원 낭비**가 발생할 수 있습니다.
-   **단점 (예외 처리 불가)**: 인스턴스 생성 과정에서 발생하는 예외를 처리할 방법이 마땅치 않습니다.

```java
  class Singleton {
    // 싱글톤 클래스 객체를 담을 인스턴스 변수
    private static final Singleton INSTANCE = new Singleton();

    // 생성자를 private로 선언 (외부에서 new 사용 X)
    private Singleton() {}

    public static Singleton getInstance() {
        return INSTANCE;
    }
}
```

<br>

## 2. Bill Pugh Solution (LazyHolder) ✨

권장되는 싱글톤 구현 방법 중 하나입니다. 멀티 스레드 환경에서도 안전하며, **Lazy Loading** (지연 로딩: 실제 사용 시점에 객체 생성)이 가능한 기법입니다.

-   **핵심 원리**: 클래스 내부에 `static` 내부 클래스(Holder)를 둡니다. 이 방식은 JVM의 클래스 로더 메커니즘을 이용하여 스레드 안전성을 보장합니다.
    -   외부 클래스가 로드될 때는 내부 `static` 클래스가 로드되지 않고, `getInstance()` 메소드가 *최초로 호출될 때* 비로소 Holder 클래스가 로드되면서 인스턴스가 생성됩니다.
-   **Static 내부 클래스**:
    -   `getInstance()` 같은 `static` 메소드에서는 `static` 멤버(Holder 클래스)만을 호출할 수 있기 때문에 내부 클래스를 `static`으로 선언합니다.
    -   또한, `static` 내부 클래스는 메모리 누수 문제를 방지하는 데 도움이 됩니다.
-   **단점**:
    -   Reflection API나 직렬화/역직렬화를 사용하면 클라이언트가 임의로 싱글톤 패턴을 파괴하고 새 인스턴스를 생성할 수 있습니다.

```java
class Singleton {

    private Singleton() {}

    // static 내부 클래스를 이용
    // Holder로 만들어, 클래스가 메모리에 로드되지 않고 getInstance 메서드가 호출되어야 로드됨
    private static class SingleInstanceHolder {
        private static final Singleton INSTANCE = new Singleton();
    }

    public static Singleton getInstance() {
        return SingleInstanceHolder.INSTANCE;
    }
}
```
<br>

## 3.Enum (열거형) 이용 ✨

권장되는 방법 중 하나입니다.

-   **스레드 안전성 (Thread-Safe)**: Enum은 애초에 멤버를 `private`로 만들고 **한 번만 초기화**하기 때문에 Thread-Safe 합니다.
-   **구현**: Enum 내에서 상수뿐만 아니라, 일반 변수(필드)나 메서드를 선언하여 싱글톤 클래스처럼 응용이 가능합니다.
-   **장점 (Reflection 방어)**: 위의 Bill Pugh Solution 기법과 달리, 클라이언트가 **Reflection을 통한 공격에도 안전**합니다.
-   **단점 (마이그레이션 문제)**: 만일 싱글톤 클래스를 멀티톤(일반적인 클래스)으로 마이그레이션해야 할 때, 처음부터 코드를 다시 짜야 하는 단점이 존재합니다.
-   **단점 (상속 제한)**: 클래스 상속이 필요한 경우, Enum 외의 다른 클래스를 상속하는 것이 불가능합니다.

```java
enum SingletonEnum {
    INSTANCE;

    private final Client dbClient;
	
    SingletonEnum() {
        dbClient = Database.getClient();
    }

    public static SingletonEnum getInstance() {
        return INSTANCE;
    }

    public Client getClient() {
        return dbClient;
    }
}

public class Main {
    public static void main(String[] args) {
        SingletonEnum singleton = SingletonEnum.getInstance();
        singleton.getClient();
    }
}
```

<br>

## 싱글톤 패턴 구현 전략 요약

최종적으로, 싱글톤 패턴 클래스를 만들기 위해서는 **Bill Pugh Solution (LazyHolder)** 기법이나 **Enum (열거형)** 방식을 사용하는 것이 권장됩니다.

다만, 이 둘의 사용 선택은 싱글톤 클래스의 주된 목적에 따라 갈린다고 볼 수 있습니다.

---

### 1. LazyHolder (Bill Pugh Solution)

* **주요 고려 사항**: **성능**이 중요시되는 환경
* (특징: Lazy Loading을 지원)

---

### 2. Enum (열거형)

* **주요 고려 사항**: **직렬화(Serialization)** 또는 **안정성**(Reflection 방어 등)이 중요시되는 환경
